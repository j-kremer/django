<!DOCTYPE html>{% load static %}
<html xmlns="http://www.w3.org/1999/html">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
        {% load l10n %}
        <style>
            div#map {
                height: 100%;
                width: 100%;
                margin: 0;
                position: relative;
            }
            body, html {
                width: 100%;
                height: 100%;
                margin: 0;
            }
            div#menu {
                position: absolute;
                z-index: 999;
                top: 0;
                left: 0;
                width: 250px;
                background-color: white;
                height: 100%;
                margin: 0;
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <script>
        function initMap() {
            var latlng = new google.maps.LatLng({{ lat|unlocalize }}, {{ long|unlocalize }});
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: latlng
            });
            var markers = [];
            var lines = []
            var infoWindows = [];
            {% for vehicle in vehicles_online %}
            markers[{{ vehicle.index }}] = new google.maps.Marker({
                position: {lat: {{ vehicle.Lat|unlocalize }}, lng: {{ vehicle.Lon|unlocalize }} },
                map: null,
                icon: '{% static "tram-icon.png" %}'
            });
            lines[{{ vehicle.index }}] = {{ vehicle.Lines }};
            infoWindows[{{ vehicle.index }}] = new google.maps.InfoWindow({
                content: '<div><b>Linia nr {{ vehicle.Lines }}</b></div><br />'+
                    'Ostatnia aktualizacja: {{ vehicle.Time }}'
            });
            markers[{{ vehicle.index }}].addListener('click', function() {
                infoWindows[{{ vehicle.index }}].open(map, markers[{{ vehicle.index }}]);
            });
            {% endfor %}
            $('#line').on('change', function() {

                for (i = 0; i < markers.length; i++) {
                    if (lines[i] == this.value)
                        markers[i].setMap(map);
                    else
                        markers[i].setMap(null);
                }
                //$('#map').hide().fadeIn(1000);
            })
        }
        </script>
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">
        </script>


    <div id="menu">
    <img src={% static "logo.jpg" %}>
    <br /><br /><br /><br />
        <form action="/" method="post" class="pure-form pure-form-aligned"><fieldset>
            {% csrf_token %}
            <div class="pure-control-group">
                <label for="line">Linia</label>
                <select name="line" id="line">
                    <option value="0">---</option>
                    {% for tram in trams_lines %}
                    <option value="{{ tram }}"{% if tram == request.POST.line %} selected{% endif %}>{{ tram }}</option>
                    {% endfor %}
                </select>
            </div>
            <br />



        </fieldset></form>
    </div>
    </body>
</html>